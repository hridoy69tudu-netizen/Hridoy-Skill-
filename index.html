<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashReward App</title>

    <script src='//libtl.com/sdk.js' data-zone='9572158' data-sdk='show_9572158'></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: #ffffff; }
        .dark-bg { background-color: #121212; }
        .card-bg { background-color: #1e1e1e; }
        .border-accent { border-color: #ff8c00; }
        .text-accent { color: #ff8c00; }
        .btn, .btn-accent, .btn-outline-accent { transition: all 0.2s ease-in-out; transform: scale(1); }
        .btn:active, .btn-accent:active, .btn-outline-accent:active { transform: scale(0.95); }
        .btn-accent { background-color: #ff8c00; color: #121212; font-weight: bold; }
        .btn-accent:hover { background-color: #e67e00; }
        .btn-outline-accent { border: 1px solid #ff8c00; color: #ff8c00; }
        .btn-outline-accent:hover { background-color: #ff8c00; color: #121212; }
        .input-field { background-color: #2c2c2c; border: 1px solid #444; }
        .user-page { display: none; }
        .user-page.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        .sidebar { background-color: #1e1e1e; }
        .sidebar-link { transition: background-color 0.2s; }
        .sidebar-link.active { background-color: #2c2c2c; }
        .progress-bar-container { background-color: #2c2c2c; border-radius: 9999px; height: 8px; overflow: hidden; }
        .progress-bar { background-color: #ff8c00; height: 100%; transition: width 0.3s ease-in-out; }

        /* Custom styles for the new design */
        .header-bg { background: linear-gradient(135deg, #2a2a2a, #1a1a1a); padding: 1rem; border-bottom-left-radius: 1.5rem; border-bottom-right-radius: 1.5rem; }
        .balance-card { background: linear-gradient(135deg, #3a3a3a, #1a1a1a); border-radius: 1.5rem; padding: 1.5rem; margin-top: -2rem; position: relative; z-index: 10; border: 1px solid #ff8c00; }
        .task-card { background: linear-gradient(135deg, #3a3a3a, #1a1a1a); border-radius: 1rem; padding: 1rem; border: 1px solid transparent; transition: all 0.2s ease; }
        .task-card:hover { border: 1px solid #ff8c00; transform: translateY(-3px); box-shadow: 0 4px 15px rgba(255, 140, 0, 0.2); }
        .task-button { background-color: #007bff; color: white; border-radius: 0.5rem; padding: 0.75rem 1rem; font-weight: bold; width: 100%; text-align: center; }
        .task-button:hover { background-color: #0056b3; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background-color: #1e1e1e; display: flex; justify-content: space-around; padding: 0.5rem 0; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3); z-index: 50; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; text-decoration: none; font-size: 0.75rem; transition: color 0.2s; padding: 0.5rem; position: relative; }
        .nav-item.active { color: #ff8c00; }
        .nav-item .lucide { width: 24px; height: 24px; margin-bottom: 0.25rem; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="loader" class="hidden fixed inset-0 dark-bg bg-opacity-75 flex items-center justify-center z-50">
    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-accent"></div>
</div>

<div id="login-section" class="min-h-screen p-6 flex-col justify-center items-center">
    <div class="max-w-md w-full mx-auto">
        <h1 class="text-4xl font-bold text-center mb-2 text-accent">Welcome</h1>
        <p class="text-center text-gray-400 mb-8">Login or Register</p>
        <div class="card-bg p-6 rounded-lg">
            <input id="login-email" type="email" placeholder="Email" class="w-full p-3 rounded-lg input-field mb-4">
            <input id="login-password" type="password" placeholder="Password" class="w-full p-3 rounded-lg input-field mb-4">
            <input id="register-name" type="text" placeholder="Full Name (for new users)" class="w-full p-3 rounded-lg input-field mb-4">
            <button id="login-btn" class="w-full p-3 rounded-lg btn-accent mb-4">Login</button>
            <button id="register-btn" class="w-full p-3 rounded-lg btn-outline-accent">Register</button>
        </div>
    </div>
</div>

<div id="user-panel-container" class="hidden min-h-screen flex flex-col">
    

<header id="main-header" class="header-bg flex items-center justify-between p-4 hidden">
        <div class="flex items-center space-x-3">
            <img src="https://via.placeholder.com/40/FF8C00/FFFFFF?text=P" alt="Profile" class="rounded-full w-10 h-10 border-2 border-accent">
            <h1 class="text-2xl font-bold text-accent">HACKER</h1>
        </div>
        <div class="flex items-center space-x-2">
            

<i data-lucide="bell" class="w-6 h-6 text-gray-400"></i>
        </div>
    </header>

    <main class="flex-grow p-4 overflow-y-auto pb-20"> 

<div id="home-page" class="user-page active">
            

<div class="balance-card mb-6 mt-4">
                <p class="text-gray-300 mb-2">Your Current Income</p>
                <p id="user-balance" class="text-5xl font-bold text-white mb-2">৳0.00</p>
                <p class="text-gray-400">Income per ad: ৳<span id="ad-earning-display">0.00</span></p>
            </div>

            

<div class="grid grid-cols-2 gap-4 mt-8">
                <div class="task-card flex flex-col items-center justify-center text-center">
                    <i data-lucide="monitor" class="w-10 h-10 text-blue-400 mb-2"></i>
                    <p class="font-bold text-lg mb-2">MoniTag Income</p>
                    <button class="task-button" onclick="showAlert('Open MoniTag Income')">Open</button>
                </div>
                <div class="task-card flex flex-col items-center justify-center text-center">
                    <i data-lucide="coins" class="w-10 h-10 text-yellow-400 mb-2"></i>
                    <p class="font-bold text-lg mb-2">Gigapub Income</p>
                    <button class="task-button" onclick="showAlert('Open Gigapub Income')">Open</button>
                </div>
                <div class="task-card flex flex-col items-center justify-center text-center">
                    <i data-lucide="globe" class="w-10 h-10 text-green-400 mb-2"></i>
                    <p class="font-bold text-lg mb-2">Web Visit</p>
                    <button class="task-button" onclick="showAlert('Open Web Visit')">Open</button>
                </div>
                <div class="task-card flex flex-col items-center justify-center text-center">
                    <i data-lucide="send" class="w-10 h-10 text-purple-400 mb-2"></i>
                    <p class="font-bold text-lg mb-2">Telegram Income</p>
                    <button class="task-button" onclick="showAlert('Open Telegram Income')">Open</button>
                </div>
            </div>

            

</div>

        <div id="tasks-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Tasks</h2>
            <p class="text-gray-400">Complete tasks to earn more coins.</p>
            <div id="tasks-list" class="space-y-4 mt-4">
                <div class="card-bg p-4 rounded-lg flex items-center justify-between">
                    <div>
                        <p class="font-bold">Watch Video Ad</p>
                        <p class="text-sm text-gray-400">Earn <span id="reward-interstitial-display">0</span> coins per ad view.</p>
                    </div>
                    <button class="btn-accent px-4 py-1 rounded-lg text-sm" onclick="handleAdWatch()">Watch Ad</button>
                </div>
            </div>
        </div>

        <div id="withdraw-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Withdraw Coins</h2>
            <div class="card-bg p-6 rounded-lg">
                <p id="min-withdrawal-text" class="text-center text-gray-400 mb-4"></p>
                <label for="withdrawal-method" class="block text-sm font-medium mb-2">Withdrawal Method</label>
                <select id="withdrawal-method" class="w-full p-3 rounded-lg input-field mb-4"></select>
                <label for="withdrawal-amount" class="block text-sm font-medium mb-2">Amount (Coins)</label>
                <input id="withdrawal-amount" type="number" placeholder="Enter amount" class="w-full p-3 rounded-lg input-field mb-4">
                <label for="payment-detail" class="block text-sm font-medium mb-2">Payment Detail (e.g. Phone Number)</label>
                <input id="payment-detail" type="text" placeholder="Enter payment detail" class="w-full p-3 rounded-lg input-field mb-4">
                <button id="withdraw-btn" class="w-full p-3 rounded-lg btn-accent">Request Withdrawal</button>
            </div>
        </div>

        <div id="refer-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Refer & Earn</h2>
            <div class="card-bg p-6 rounded-lg text-center">
                <p class="text-gray-400 mb-4">Share your referral code to invite friends and earn coins.</p>
                <p id="referral-code" class="text-4xl font-bold text-accent mb-4"></p>
                <button id="copy-referral-btn" class="btn-accent px-6 py-2 rounded-lg">Copy Code</button>
            </div>
        </div>

        <div id="history-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Transaction History</h2>
            <div id="history-list" class="space-y-4"></div>
        </div>

        <div id="notifications-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Notifications</h2>
            <div id="notifications-list" class="space-y-4">
                <p class="text-gray-400 text-center">No new notifications.</p>
            </div>
        </div>

        <div id="settings-page" class="user-page">
            <h2 class="text-3xl font-bold mb-6">Settings</h2>
            <div class="card-bg p-6 rounded-lg">
                <p class="text-gray-400">Settings options will appear here.</p>
                

</div>
        </div>

    </main>

    

<nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="home-page">
            <i data-lucide="home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item" data-page="withdraw-page">
            <i data-lucide="briefcase"></i>
            <span>Wallet</span>
        </a>
        <a href="#" class="nav-item" data-page="notifications-page">
            <i data-lucide="megaphone"></i>
            <span>Alert</span>
        </a>
        <a href="#" class="nav-item" data-page="refer-page">
            <i data-lucide="user-square"></i>
            <span>Refer</span>
        </a>
        <a href="#" class="nav-item" data-page="settings-page">
            <i data-lucide="settings"></i>
            <span>Settings</span>
        </a>
    </nav>
</div>

<div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm text-center">
        <p id="alert-message" class="mb-4"></p>
        <button id="alert-ok-btn" class="btn-accent px-6 py-2 rounded-lg">OK</button>
    </div>
</div>

<script type="module">
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAuRjoQd88a3sRaU-mZyogapNCjgDbc4R8",
      authDomain: "hridoy-skill-1.firebaseapp.com",
      databaseURL: "https://hridoy-skill-1-default-rtdb.firebaseio.com",
      projectId: "hridoy-skill-1",
      storageBucket: "hridoy-skill-1.firebasestorage.app",
      messagingSenderId: "840073498608",
      appId: "1:840073498608:web:4741e43ca186e027a95735",
      measurementId: "G-YG5H5ZFBR8"
    };

    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, query, orderBy, where, serverTimestamp, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userData = null;
    let appConfig = null;
    const today = new Date().toISOString().slice(0, 10);

    // DOM Elements
    const loader = document.getElementById('loader');
    const loginSection = document.getElementById('login-section');
    const userPanelContainer = document.getElementById('user-panel-container');
    const userBalanceEl = document.getElementById('user-balance');
    const adEarningDisplayEl = document.getElementById('ad-earning-display');
    const adCountDisplay = document.getElementById('ad-count-display'); // Still exists in tasks page
    const adProgressBar = document.getElementById('ad-progress-bar'); // Still exists in tasks page
    const userNameEl = document.getElementById('user-name'); // For header, might be less visible now
    const referralCodeEl = document.getElementById('referral-code');
    const historyListEl = document.getElementById('history-list');
    const withdrawalMethodSelect = document.getElementById('withdrawal-method');
    const minWithdrawalTextEl = document.getElementById('min-withdrawal-text');
    const registerNameInput = document.getElementById('register-name');
    const mainHeader = document.getElementById('main-header'); // New header for home page
    const notificationsListEl = document.getElementById('notifications-list');


    // On Load & Auth State Change
    window.onload = () => {
        lucide.createIcons();
        setupEventListeners();
        onAuthStateChanged(auth, handleAuthStateChange);
    };

    async function handleAuthStateChange(user) {
        if (user) {
            loader.style.display = 'flex';
            try {
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    userData = userDoc.data();
                    const configDocRef = doc(db, "config", "main");
                    const configDoc = await getDoc(configDocRef);
                    appConfig = configDoc.exists() ? configDoc.data() : null;

                    if (userData.isBlocked) {
                        showAlert("Your account has been blocked.");
                        await signOut(auth);
                        return;
                    }

                    loginSection.classList.add('hidden');
                    userPanelContainer.classList.remove('hidden');
                    updateUI();
                    loadHistory();
                    loadWithdrawalMethods();
                    loadNotifications(); // Load notifications for user
                } else {
                    // This case should not be hit with the new logic, but kept as a fallback
                    showAlert("User data not found. Please try logging in again.");
                    await signOut(auth);
                }
            } catch (error) {
                console.error("Error loading user data:", error);
                showAlert("Error loading user data.");
            } finally {
                loader.style.display = 'none';
            }
        } else {
            loginSection.classList.remove('hidden');
            userPanelContainer.classList.add('hidden');
        }
        loader.style.display = 'none';
    }

    // Auth Functions
    async function handleLogin() {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        if (!email || !password) {
            return showAlert("Please enter both email and password.");
        }
        loader.style.display = 'flex';
        try {
            await signInWithEmailAndPassword(auth, email, password);
        } catch (error) {
            showAlert("Login failed: " + error.message);
        } finally {
            loader.style.display = 'none';
        }
    }

    async function handleRegister() {
        const name = registerNameInput.value.trim();
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        if (!name || !email || !password) {
            return showAlert("Please fill in all fields (Full Name, Email, Password).");
        }
        loader.style.display = 'flex';
        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
            await setDoc(doc(db, "users", user.uid), {
                uid: user.uid,
                email: email,
                name: name,
                balance: 0,
                dailyAdCount: 0,
                lastAdWatchDate: '',
                isBlocked: false,
                createdAt: serverTimestamp()
            });
            showAlert("Registration successful! Welcome.");
        } catch (error) {
            showAlert("Registration failed: " + error.message);
        } finally {
            loader.style.display = 'none';
        }
    }

    async function handleLogout() {
        await signOut(auth);
    }

    // UI Updates
    function updateUI() {
        if (!userData || !appConfig) return;

        // Header for home page, username can be adjusted if needed
        // userNameEl.textContent = userData.name || userData.email;
        
        // Home page balance and ad earning
        userBalanceEl.textContent = `৳${(userData.balance || 0).toFixed(2)}`;
        adEarningDisplayEl.textContent = (appConfig.rewards.interstitial || 0).toFixed(2);
        
        referralCodeEl.textContent = userData.uid.slice(0, 10);
        minWithdrawalTextEl.textContent = `Minimum withdrawal amount: ${appConfig.minWithdrawal || 0} coins`;

        // Task page ad details
        document.getElementById('reward-interstitial-display').textContent = appConfig.rewards.interstitial || 0;

        const dailyLimit = appConfig.dailyAdLimit || 0;
        const currentCount = userData.lastAdWatchDate === today ? userData.dailyAdCount : 0;
        if (adCountDisplay) { // Check if element exists before updating
             adCountDisplay.textContent = `${currentCount}/${dailyLimit}`;
        }
        if (adProgressBar) { // Check if element exists before updating
            const progress = dailyLimit > 0 ? (currentCount / dailyLimit) * 100 : 0;
            adProgressBar.style.width = `${progress}%`;
        }
        const watchAdBtn = document.getElementById('watch-ad-btn');
        if (watchAdBtn) {
            watchAdBtn.disabled = currentCount >= dailyLimit;
        }
    }

    // Tasks & Ads
    async function handleAdWatch() {
        if (!userData || !appConfig) {
            return showAlert("Ad not available. Please try again later.");
        }
        
        loader.style.display = 'flex';
        
        const dailyLimit = appConfig.dailyAdLimit || 0;
        if (userData.lastAdWatchDate !== today) {
            // Reset daily count if it's a new day
            userData.dailyAdCount = 0;
            const userRef = doc(db, "users", userData.uid);
            await updateDoc(userRef, { dailyAdCount: 0, lastAdWatchDate: today });
        }

        if ((userData.dailyAdCount || 0) >= dailyLimit) {
            showAlert("You have reached the daily ad limit.");
            loader.style.display = 'none';
            return;
        }

        try {
            await window.show_9572158(); // Show the ad
            const rewardAmount = appConfig.rewards.interstitial || 0;
            const userRef = doc(db, "users", userData.uid);
            const newAdCount = (userData.dailyAdCount || 0) + 1;
            
            await updateDoc(userRef, { 
                balance: (userData.balance || 0) + rewardAmount,
                dailyAdCount: newAdCount,
                lastAdWatchDate: today
            });

            userData.balance += rewardAmount;
            userData.dailyAdCount = newAdCount;
            userData.lastAdWatchDate = today;

            updateUI();
            showAlert(`Congratulations! You have won ${rewardAmount} coins.`);
        } catch(e) {
            console.error("Ad or database update error:", e);
            showAlert('Could not show ad or update your balance. Please try again later.');
        } finally {
            loader.style.display = 'none';
        }
    }

    // Withdrawals
    async function handleWithdrawal() {
        const amount = parseInt(document.getElementById('withdrawal-amount').value);
        const method = withdrawalMethodSelect.value;
        const detail = document.getElementById('payment-detail').value;

        if (isNaN(amount) || amount <= 0 || !method || !detail) {
            return showAlert("Please fill in all withdrawal details correctly.");
        }
        if (amount > userData.balance) {
            return showAlert("You do not have enough coins.");
        }
        if (amount < appConfig.minWithdrawal) {
            return showAlert(`The minimum withdrawal amount is ${appConfig.minWithdrawal} coins.`);
        }

        loader.style.display = 'flex';
        try {
            const userRef = doc(db, "users", userData.uid);
            await updateDoc(userRef, { balance: userData.balance - amount });

            const withdrawalsRef = collection(db, "withdrawals");
            await addDoc(withdrawalsRef, {
                userId: userData.uid,
                userName: userData.name,
                userEmail: userData.email,
                amount: amount,
                method: method,
                paymentDetail: detail,
                status: 'pending',
                requestedAt: serverTimestamp()
            });

            userData.balance -= amount;
            updateUI();
            showAlert("Withdrawal request submitted successfully!");
        } catch (error) {
            console.error("Error submitting withdrawal:", error);
            showAlert("Failed to submit withdrawal request.");
        } finally {
            loader.style.display = 'none';
        }
    }

    async function loadWithdrawalMethods() {
        if (!appConfig || !appConfig.paymentMethods) return;
        withdrawalMethodSelect.innerHTML = '';
        appConfig.paymentMethods.forEach(method => {
            const option = document.createElement('option');
            option.value = method;
            option.textContent = method;
            withdrawalMethodSelect.appendChild(option);
        });
    }

    // History
    async function loadHistory() {
        if (!userData) return;
        historyListEl.innerHTML = '<p class="text-gray-400 text-center">Loading history...</p>';
        try {
            const q = query(collection(db, "withdrawals"), where("userId", "==", userData.uid), orderBy("requestedAt", "desc"));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                historyListEl.innerHTML = '<p class="text-gray-400 text-center">No withdrawal history found.</p>';
                return;
            }

            historyListEl.innerHTML = '';
            querySnapshot.forEach(doc => {
                const req = doc.data();
                const date = req.requestedAt ? new Date(req.requestedAt.seconds * 1000).toLocaleString() : 'N/A';
                const statusColor = req.status === 'pending' ? 'text-yellow-400' : (req.status === 'approved' ? 'text-green-400' : 'text-red-400');
                historyListEl.innerHTML += `<div class="card-bg p-4 rounded-lg flex items-center justify-between">
                    <div>
                        <p class="font-bold">${req.amount} Coins</p>
                        <p class="text-sm text-gray-400">Via ${req.method}</p>
                        <p class="text-xs text-gray-500">${date}</p>
                    </div>
                    <span class="${statusColor} font-semibold capitalize">${req.status}</span>
                </div>`;
            });
        } catch (error) {
            console.error("Error loading history:", error);
            historyListEl.innerHTML = '<p class="text-red-400 text-center">Error loading history.</p>';
        }
    }

    // Notifications
    async function loadNotifications() {
        if (!userData) return;
        notificationsListEl.innerHTML = '<p class="text-gray-400 text-center">Loading notifications...</p>';
        try {
            const q = query(collection(db, "notifications"), orderBy("createdAt", "desc"));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                notificationsListEl.innerHTML = '<p class="text-gray-400 text-center">No new notifications.</p>';
                return;
            }

            notificationsListEl.innerHTML = '';
            querySnapshot.forEach(doc => {
                const notification = doc.data();
                const date = notification.createdAt ? new Date(notification.createdAt.seconds * 1000).toLocaleString() : 'N/A';
                notificationsListEl.innerHTML += `<div class="card-bg p-4 rounded-lg">
                    <p class="font-bold text-lg mb-1">${notification.title}</p>
                    <p class="text-gray-300 text-sm mb-2">${notification.message}</p>
                    <p class="text-xs text-gray-500">${date}</p>
                </div>`;
            });
        } catch (error) {
            console.error("Error loading notifications:", error);
            notificationsListEl.innerHTML = '<p class="text-red-400 text-center">Error loading notifications.</p>';
        }
    }
    
    // Navigation & UI
    function navigateTo(pageId) {
        document.querySelectorAll('.user-page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        // Update active class for bottom navigation
        document.querySelectorAll('.nav-item').forEach(link => {
            link.classList.remove('active');
            if (link.dataset.page === pageId) link.classList.add('active');
        });

        // Show/hide main header based on page
        if (pageId === 'home-page') {
            mainHeader.classList.remove('hidden');
        } else {
            mainHeader.classList.add('hidden');
        }
        
        // Reload data for specific pages if needed
        if (pageId === 'history-page') loadHistory();
        if (pageId === 'notifications-page') loadNotifications();
        // Add more conditional loads for other pages if necessary
    }

    function setupEventListeners() {
        document.getElementById('login-btn').addEventListener('click', handleLogin);
        document.getElementById('register-btn').addEventListener('click', handleRegister);
        document.getElementById('logout-btn').addEventListener('click', handleLogout);
        // document.getElementById('watch-ad-btn').addEventListener('click', handleAdWatch); // Now triggered by task cards
        document.getElementById('withdraw-btn').addEventListener('click', handleWithdrawal);
        document.getElementById('copy-referral-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(referralCodeEl.textContent);
            showAlert("Referral code copied to clipboard!");
        });
        
        // Bottom Navigation event listeners
        document.querySelectorAll('.bottom-nav .nav-item').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo(e.currentTarget.dataset.page);
            });
        });
    }
    
    // Utility Alert
    function showAlert(message) {
        document.getElementById('alert-message').textContent = message;
        document.getElementById('custom-alert').classList.remove('hidden');
        document.getElementById('alert-ok-btn').onclick = () => {
            document.getElementById('custom-alert').classList.add('hidden');
        };
    }
    window.showAlert = showAlert;
</script>
</body>
</html>
